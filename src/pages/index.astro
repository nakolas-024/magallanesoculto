---
import Layout from '../components/Layout.astro';
import BannerPlaceholder from '../components/BannerPlaceholder.astro';
import DenunciasCarousel from '../components/DenunciasCarousel.astro'; // 1. Importamos el carrusel
import Modal from '../components/Modal.astro';                     // 2. Importamos el modal

const mdPostsGlob = import.meta.glob('../content/blog/*.md', { eager: true });
const mdxPostsGlob = import.meta.glob('../content/blog/*.mdx', { eager: true });

const allPosts = [...Object.values(mdPostsGlob), ...Object.values(mdxPostsGlob)] as any[];
const sortedPosts = allPosts
  .sort((a: any, b: any) => new Date(b.frontmatter.date).getTime() - new Date(a.frontmatter.date).getTime())
  .slice(0, 3);
---

<Layout 
  title="Magallanes Oculto: Pueblo Chico, Infierno Grande" 
  description="Periodismo independiente y denuncias ciudadanas para exponer la corrupción y las injusticias en Magallanes." 
  showSidebar={false}
>
  
  <BannerPlaceholder class="mt-0" />
  
  <DenunciasCarousel />

  <div class="landing-page">
    <section class="hero">
      <div class="hero-content">
        <h1 class="hero-title">Magallanes Oculto</h1>
        <p class="hero-subtitle">"Pueblo Chico, Infierno Grande"</p>
        <p class="hero-description">
          Periodismo de investigación sin censura, respaldado por la evidencia de los ciudadanos para exponer la verdad sobre el poder en Magallanes.
        </p>
        <hr class="hero-rule" />
        <div class="hero-actions">
          <a href={`${import.meta.env.BASE_URL}blog`} class="btn btn-primary">Últimas Investigaciones</a>
          <a href={`${import.meta.env.BASE_URL}denuncia`} class="btn btn-secondary">Envía tu Denuncia</a>
        </div>
      </div>
    </section>

    {/* ... (resto de las secciones se mantienen igual) ... */}
    <section class="demo-section" id="investigaciones">
        <div class="container">
          <h2 class="section-title">Investigaciones Destacadas</h2>
          <p class="demo-description">
            Los reportajes más recientes que exponen la realidad de la región, directo a los hechos y sin filtros.
          </p>
          
          {sortedPosts.length > 0 && (
            <div class="demo-posts">
              {sortedPosts.map(post => (
                <article class="demo-post-card">
                  <h3 class="demo-post-title">
                    <a href={`${import.meta.env.BASE_URL}blog/${post.file.split('/').pop()?.replace(/\.(md|mdx)$/, '')}`}>{post.frontmatter.title}</a>
                  </h3>
                  <div class="demo-post-meta">
                    <time class="demo-post-date" datetime={post.frontmatter.date}>
                      {new Date(post.frontmatter.date).toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' })}
                    </time>
                    <span class="demo-post-reading-time">5 min de lectura</span>
                  </div>
                  {post.frontmatter.excerpt && (<p class="demo-post-excerpt">{post.frontmatter.excerpt}</p>)}
                </article>
              ))}
            </div>
          )}
          
          <div class="demo-actions">
            <a href={`${import.meta.env.BASE_URL}blog`} class="btn btn-primary">Ver Todas las Investigaciones</a>
          </div>
        </div>
      </section>
  
      <div class="container">
        <BannerPlaceholder height="250px" />
      </div>
  
      <section class="features" id="secciones">
        <div class="container">
          <h2 class="section-title">Nuestras Secciones</h2>
          <div class="features-grid">
            <div class="feature-card">
              <h3 class="feature-title">Scarleth Investiga</h3>
              <p class="feature-description">Reportajes a fondo, análisis y columnas de opinión sobre los temas que marcan la pauta en la región.</p>
            </div>
            <div class="feature-card">
              <h3 class="feature-title">Denuncia Ciudadana</h3>
              <p class="feature-description">Un archivo público de denuncias con evidencia, donde la comunidad puede exponer irregularidades de forma segura.</p>
            </div>
            <div class="feature-card">
              <h3 class="feature-title">Actúa</h3>
              <p class="feature-description">El espacio para participar activamente. Envía tu denuncia, apoya nuestro trabajo con una donación o contáctanos para ser sponsor.</p>
            </div>
          </div>
        </div>
      </section>
  
      <section class="typography-showcase">
        <div class="container">
          <h2 class="section-title">Manifiesto</h2>
          <p class="typography-description">
            Creemos en un periodismo sin miedo, fiscalizador e independiente del poder político y económico. Nuestra única lealtad es con los hechos y con los ciudadanos de Magallanes.
          </p>
          <div class="typography-samples">
            <div class="type-sample">
              <h1 class="sample-h1">VERDAD</h1>
              <p class="type-meta">Compromiso con la evidencia</p>
            </div>
            <div class="type-sample">
              <p class="sample-body">Creemos que una comunidad informada es una comunidad empoderada. La transparencia no es una opción, es una obligación.</p>
              <p class="type-meta">Independencia • Rigurosidad</p>
            </div>
          </div>
        </div>
      </section>
  
      <div class="container">
        <BannerPlaceholder />
      </div>
  
      <section class="installation" id="participa">
        <div class="container">
          <h2 class="section-title">Tu Participación es Clave</h2>
          <div class="install-steps">
            <div class="step">
              <h3 class="step-number">01</h3>
              <div class="step-content">
                <h4 class="step-title">Envía tu Denuncia</h4>
                <p>¿Tienes pruebas de un acto de corrupción o negligencia? Usa nuestro <a href={`${import.meta.env.BASE_URL}actua`}>formulario seguro</a>. Tu identidad estará protegida.</p>
              </div>
            </div>
            <div class="step">
              <h3 class="step-number">02</h3>
              <div class="step-content">
                <h4 class="step-title">Apoya Nuestro Trabajo</h4>
                <p>Somos un medio independiente y nos financiamos gracias a los aportes de la comunidad. <a href={`${import.meta.env.BASE_URL}actua`}>Considera donar</a> para que podamos seguir investigando.</p>
              </div>
            </div>
            <div class="step">
              <h3 class="step-number">03</h3>
              <div class="step-content">
                <h4 class="step-title">Conviértete en Sponsor</h4>
                <p>Si tu empresa cree en la transparencia, <a href={`${import.meta.env.BASE_URL}actua`}>contáctanos</a> para explorar formas de patrocinio que no comprometan nuestra independencia editorial.</p>
              </div>
            </div>
          </div>
        </div>
      </section>
  </div>

  <Modal
    id="publicidad-index"
    href="https://sitio-del-anunciante.com"
    src="https://via.placeholder.com/400x400.png?text=Anuncio+de+Portada"
    alt="Anuncio de Portada"
  />

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const modal = document.getElementById('modal-publicidad-index');
      if (modal) {
        // Con un pequeño retraso para no ser tan abrupto
        setTimeout(() => {
          modal.classList.remove('hidden');
        }, 1500); // 1.5 segundos
      }
    });
  </script>

</Layout>

<style>
/* Estilos originales de la plantilla sin cambios */
  .landing-page { width: 100%; }
  .container { max-width: 1200px; margin: 0 auto; padding: 0 var(--content-padding); }
  .hero { text-align: center; padding: calc(var(--grid-unit) * 12) 0 calc(var(--grid-unit) * 8); background: linear-gradient(135deg, var(--color-surface) 0%, var(--color-background) 100%); }
  .hero-content { max-width: 800px; margin: 0 auto; padding: 0 var(--content-padding); }
  .hero-title { font-family: var(--font-heading-primary); font-size: 4.5rem; font-weight: 700; color: var(--color-text-primary); text-transform: uppercase; letter-spacing: 0.15em; line-height: 1; margin-bottom: calc(var(--grid-unit) * 2); }
  .hero-subtitle { font-family: var(--font-heading-secondary); font-size: 1.5rem; font-weight: 700; color: var(--color-text-muted); text-transform: uppercase; letter-spacing: 0.2em; margin-bottom: calc(var(--grid-unit) * 3); }
  .hero-description { font-size: 1.375rem; line-height: 1.6; color: var(--color-text-primary); margin-bottom: calc(var(--grid-unit) * 4); max-width: 600px; margin-left: auto; margin-right: auto; }
  .hero-rule { height: 6px; background-color: var(--color-accent); border: none; width: 150px; margin: 0 auto calc(var(--grid-unit) * 4); }
  .hero-actions { display: flex; gap: calc(var(--grid-unit) * 2); justify-content: center; flex-wrap: wrap; }
  .btn { font-family: var(--font-heading-secondary); font-weight: 700; text-transform: uppercase; letter-spacing: 0.05em; padding: calc(var(--grid-unit) * 1.5) calc(var(--grid-unit) * 3); border-radius: 4px; transition: all 0.3s ease; text-decoration: none; display: inline-block; font-size: 0.95rem; }
  .btn-primary { background-color: var(--color-accent); color: white; border: 2px solid var(--color-accent); }
  .btn-primary:hover, .btn-primary:focus { background-color: transparent; color: var(--color-accent); transform: translateY(-2px); }
  .btn-secondary { background-color: transparent; color: var(--color-text-primary); border: 2px solid var(--color-border); }
  .btn-secondary:hover, .btn-secondary:focus { background-color: var(--color-text-primary); color: var(--color-background); transform: translateY(-2px); }
  :global([data-theme="dark"]) .btn-primary { background-color: var(--color-accent); color: white; border-color: var(--color-accent); }
  :global([data-theme="dark"]) .btn-primary:hover, :global([data-theme="dark"]) .btn-primary:focus { background-color: transparent; color: var(--color-accent); }
  :global([data-theme="dark"]) .btn-secondary { background-color: transparent; color: var(--color-text-primary); border-color: var(--color-border); }
  :global([data-theme="dark"]) .btn-secondary:hover, :global([data-theme="dark"]) .btn-secondary:focus { background-color: var(--color-accent); color: white; border-color: var(--color-accent); }
  .features { padding: calc(var(--grid-unit) * 8) 0; }
  .section-title { font-family: var(--font-heading-secondary); font-size: 2.5rem; font-weight: 900; color: var(--color-accent); text-transform: uppercase; letter-spacing: 0.1em; margin-bottom: calc(var(--grid-unit) * 6); text-align: center; }
  .features-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: calc(var(--grid-unit) * 4); }
  .feature-card { background-color: var(--color-surface); border: 1px solid var(--color-border); border-radius: 8px; padding: calc(var(--grid-unit) * 4); text-align: center; transition: transform 0.3s ease, border-color 0.3s ease; }
  .feature-card:hover { transform: translateY(-4px); border-color: var(--color-accent); }
  .feature-title { font-family: var(--font-heading-secondary); font-size: 1.25rem; font-weight: 700; color: var(--color-accent); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: calc(var(--grid-unit) * 1.5); }
  .feature-description { color: var(--color-text-secondary); line-height: 1.6; margin: 0; }
  .typography-showcase { padding: calc(var(--grid-unit) * 8) 0; background-color: var(--color-surface); }
  .typography-description { text-align: center; font-size: 1.125rem; color: var(--color-text-secondary); margin-bottom: calc(var(--grid-unit) * 6); max-width: 600px; margin-left: auto; margin-right: auto; }
  .typography-samples { display: grid; gap: calc(var(--grid-unit) * 6); }
  .type-sample { text-align: center; padding: calc(var(--grid-unit) * 4); background-color: var(--color-background); border: 1px solid var(--color-border); border-radius: 8px; }
  .sample-h1 { font-family: var(--font-heading-primary); font-size: 3.5rem; font-weight: 700; color: var(--color-accent); text-transform: uppercase; letter-spacing: 0.15em; line-height: 1.1; margin-bottom: calc(var(--grid-unit) * 2); }
  .sample-body { font-family: var(--font-body); font-size: 1.125rem; line-height: 1.6; color: var(--color-text-primary); margin-bottom: calc(var(--grid-unit) * 2); max-width: 600px; margin-left: auto; margin-right: auto; }
  .sample-code { font-family: var(--font-mono); background-color: var(--color-surface); border: 1px solid var(--color-border); padding: calc(var(--grid-unit)) calc(var(--grid-unit) * 1.5); border-radius: 4px; display: inline-block; margin-bottom: calc(var(--grid-unit) * 2); color: var(--color-text-primary); }
  .type-meta { font-family: var(--font-mono); font-size: 0.85rem; color: var(--color-text-muted); text-transform: uppercase; letter-spacing: 0.05em; margin: 0; }
  .demo-section { padding: calc(var(--grid-unit) * 8) 0; }
  .demo-description { text-align: center; font-size: 1.125rem; line-height: 1.6; color: var(--color-text-secondary); margin-bottom: calc(var(--grid-unit) * 6); max-width: 600px; margin-left: auto; margin-right: auto; }
  .demo-posts { display: grid; grid-template-columns: repeat(auto-fit, minmax(340px, 1fr)); gap: calc(var(--grid-unit) * 4); margin-bottom: calc(var(--grid-unit) * 6); }
  .demo-post-card { background-color: var(--color-surface); border: 1px solid var(--color-border); border-radius: 8px; padding: calc(var(--grid-unit) * 3); transition: transform 0.2s ease, border-color 0.2s ease; display: flex; flex-direction: column; }
  .demo-post-card:hover { transform: translateY(-2px); border-color: var(--color-accent); }
  .demo-post-title { font-family: var(--font-heading-secondary); font-size: 1.5rem; font-weight: 700; margin-bottom: calc(var(--grid-unit)); }
  .demo-post-title a { color: var(--color-text-primary); text-decoration: none; }
  .demo-post-title a:hover, .demo-post-title a:focus { color: var(--color-accent); }
  .demo-post-meta { display: flex; align-items: center; flex-wrap: wrap; gap: calc(var(--grid-unit)); margin-bottom: calc(var(--grid-unit) * 1.5); }
  .demo-post-date { font-family: var(--font-mono); font-size: 0.85rem; color: var(--color-text-muted); text-transform: uppercase; letter-spacing: 0.05em; }
  .demo-post-reading-time { font-family: var(--font-mono); font-size: 0.85rem; color: var(--color-text-muted); text-transform: uppercase; letter-spacing: 0.05em; }
  .demo-post-reading-time::before { content: "•"; margin: 0 calc(var(--grid-unit) / 2); color: var(--color-border); }
  .demo-post-excerpt { color: var(--color-text-secondary); line-height: 1.6; margin-bottom: calc(var(--grid-unit) * 2); margin-top: auto; }
  .demo-post-categories { display: flex; flex-wrap: wrap; gap: calc(var(--grid-unit) / 2); }
  .demo-category { background-color: var(--color-text-primary); color: white; padding: calc(var(--grid-unit) / 4) calc(var(--grid-unit) / 2); font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em; border-radius: 2px; }
  :global([data-theme="dark"]) .demo-category { background-color: var(--color-surface); color: var(--color-text-primary); border: 1px solid var(--color-border); }
  .demo-actions { text-align: center; }
  .installation { padding: calc(var(--grid-unit) * 8) 0; background-color: var(--color-surface); }
  .install-steps { display: grid; gap: calc(var(--grid-unit) * 4); }
  .step { display: grid; grid-template-columns: auto 1fr; gap: calc(var(--grid-unit) * 2); align-items: start; }
  .step-number { font-family: var(--font-heading-primary); font-size: 3rem; font-weight: 900; color: var(--color-accent); margin: 0; }
  .step-content { display: flex; flex-direction: column; }
  .step-title { font-family: var(--font-heading-secondary); font-size: 1.25rem; font-weight: 700; color: var(--color-text-primary); text-transform: uppercase; letter-spacing: 0.05em; margin-bottom: calc(var(--grid-unit)); }
  .step-content p { color: var(--color-text-secondary); margin: 0; line-height: 1.6; }
  .step-content a { color: var(--color-accent); text-decoration: none; }
  .step-content a:hover { text-decoration: underline; }
  @media (max-width: 768px) {
    .hero-title { font-size: 3rem; }
    .hero-description { font-size: 1.125rem; }
    .hero-actions { flex-direction: column; align-items: center; }
    .features-grid, .demo-posts { grid-template-columns: 1fr; }
    .step { grid-template-columns: 1fr; text-align: center; }
    .step-number { font-size: 2rem; }
  }
</style>